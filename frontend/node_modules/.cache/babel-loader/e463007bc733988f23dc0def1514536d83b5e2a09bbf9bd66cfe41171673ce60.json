{"ast":null,"code":"import { uniqWith, pathOr, last } from 'ramda';\nimport { toValue } from '@swagger-api/apidom-core';\nimport { OperationParametersElement } from '@swagger-api/apidom-ns-openapi-3-0';\nimport NormalizeStorage from \"./normalize-header-examples/NormalizeStorage.mjs\";\n/**\n * Inheritance of Parameter Objects.\n *\n * OpenAPI 3.1 specification excerpt that defines the inheritance behavior:\n *\n * A list of parameters that are applicable for this operation. If a parameter is already defined at the Path Item,\n * the new definition will override it but can never remove it. The list MUST NOT include duplicated parameters.\n * A unique parameter is defined by a combination of a name and location.\n *\n * NOTE: this plugin is idempotent\n * @public\n */\n/* eslint-disable no-param-reassign */\n/**\n * @public\n */\nconst plugin = function () {\n  let {\n    storageField = 'x-normalized'\n  } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  return toolbox => {\n    const {\n      predicates,\n      ancestorLineageToJSONPointer\n    } = toolbox;\n    /**\n     * Establishes identity between two Parameter Objects.\n     *\n     * {@link https://github.com/OAI/OpenAPI-Specification/blob/main/versions/3.1.0.md#user-content-operationparameters}\n     */\n    const parameterEquals = (parameter1, parameter2) => {\n      if (!predicates.isParameterElement(parameter1)) return false;\n      if (!predicates.isParameterElement(parameter2)) return false;\n      if (!predicates.isStringElement(parameter1.name)) return false;\n      if (!predicates.isStringElement(parameter1.in)) return false;\n      if (!predicates.isStringElement(parameter2.name)) return false;\n      if (!predicates.isStringElement(parameter2.in)) return false;\n      return toValue(parameter1.name) === toValue(parameter2.name) && toValue(parameter1.in) === toValue(parameter2.in);\n    };\n    const pathItemParameters = [];\n    let storage;\n    return {\n      visitor: {\n        OpenApi3_1Element: {\n          enter(element) {\n            storage = new NormalizeStorage(element, storageField, 'parameters');\n          },\n          leave() {\n            storage = undefined;\n          }\n        },\n        PathItemElement: {\n          enter(pathItemElement, key, parent, path, ancestors) {\n            // skip visiting this Path Item\n            if (ancestors.some(predicates.isComponentsElement)) {\n              return;\n            }\n            const {\n              parameters\n            } = pathItemElement;\n            if (predicates.isArrayElement(parameters)) {\n              pathItemParameters.push([...parameters.content]);\n            } else {\n              pathItemParameters.push([]);\n            }\n          },\n          leave() {\n            pathItemParameters.pop();\n          }\n        },\n        OperationElement: {\n          leave(operationElement, key, parent, path, ancestors) {\n            const parentPathItemParameters = last(pathItemParameters);\n\n            // no Path Item Object parameters to inherit from\n            if (!Array.isArray(parentPathItemParameters) || parentPathItemParameters.length === 0) {\n              return;\n            }\n            const operationJSONPointer = ancestorLineageToJSONPointer([...ancestors, parent, operationElement]);\n\n            // skip visiting this Operation Object if it's already normalized\n            if (storage.includes(operationJSONPointer)) {\n              return;\n            }\n            const operationParameters = pathOr([], ['parameters', 'content'], operationElement);\n\n            // prefers the first item if two items compare equal based on the predicate\n            const mergedParameters = uniqWith(parameterEquals, [...operationParameters, ...parentPathItemParameters]);\n            operationElement.parameters = new OperationParametersElement(mergedParameters);\n            storage.append(operationJSONPointer);\n          }\n        }\n      }\n    };\n  };\n};\n/* eslint-enable */\n\nexport default plugin;","map":{"version":3,"names":["uniqWith","pathOr","last","toValue","OperationParametersElement","NormalizeStorage","plugin","storageField","arguments","length","undefined","toolbox","predicates","ancestorLineageToJSONPointer","parameterEquals","parameter1","parameter2","isParameterElement","isStringElement","name","in","pathItemParameters","storage","visitor","OpenApi3_1Element","enter","element","leave","PathItemElement","pathItemElement","key","parent","path","ancestors","some","isComponentsElement","parameters","isArrayElement","push","content","pop","OperationElement","operationElement","parentPathItemParameters","Array","isArray","operationJSONPointer","includes","operationParameters","mergedParameters","append"],"sources":["/var/www/ranvijay.capricorn.online/mohit/frontend/node_modules/@swagger-api/apidom-ns-openapi-3-1/src/refractor/plugins/normalize-parameters.mjs"],"sourcesContent":["import { uniqWith, pathOr, last } from 'ramda';\nimport { toValue } from '@swagger-api/apidom-core';\nimport { OperationParametersElement } from '@swagger-api/apidom-ns-openapi-3-0';\nimport NormalizeStorage from \"./normalize-header-examples/NormalizeStorage.mjs\";\n/**\n * Inheritance of Parameter Objects.\n *\n * OpenAPI 3.1 specification excerpt that defines the inheritance behavior:\n *\n * A list of parameters that are applicable for this operation. If a parameter is already defined at the Path Item,\n * the new definition will override it but can never remove it. The list MUST NOT include duplicated parameters.\n * A unique parameter is defined by a combination of a name and location.\n *\n * NOTE: this plugin is idempotent\n * @public\n */\n/* eslint-disable no-param-reassign */\n/**\n * @public\n */\nconst plugin = ({\n  storageField = 'x-normalized'\n} = {}) => toolbox => {\n  const {\n    predicates,\n    ancestorLineageToJSONPointer\n  } = toolbox;\n  /**\n   * Establishes identity between two Parameter Objects.\n   *\n   * {@link https://github.com/OAI/OpenAPI-Specification/blob/main/versions/3.1.0.md#user-content-operationparameters}\n   */\n  const parameterEquals = (parameter1, parameter2) => {\n    if (!predicates.isParameterElement(parameter1)) return false;\n    if (!predicates.isParameterElement(parameter2)) return false;\n    if (!predicates.isStringElement(parameter1.name)) return false;\n    if (!predicates.isStringElement(parameter1.in)) return false;\n    if (!predicates.isStringElement(parameter2.name)) return false;\n    if (!predicates.isStringElement(parameter2.in)) return false;\n    return toValue(parameter1.name) === toValue(parameter2.name) && toValue(parameter1.in) === toValue(parameter2.in);\n  };\n  const pathItemParameters = [];\n  let storage;\n  return {\n    visitor: {\n      OpenApi3_1Element: {\n        enter(element) {\n          storage = new NormalizeStorage(element, storageField, 'parameters');\n        },\n        leave() {\n          storage = undefined;\n        }\n      },\n      PathItemElement: {\n        enter(pathItemElement, key, parent, path, ancestors) {\n          // skip visiting this Path Item\n          if (ancestors.some(predicates.isComponentsElement)) {\n            return;\n          }\n          const {\n            parameters\n          } = pathItemElement;\n          if (predicates.isArrayElement(parameters)) {\n            pathItemParameters.push([...parameters.content]);\n          } else {\n            pathItemParameters.push([]);\n          }\n        },\n        leave() {\n          pathItemParameters.pop();\n        }\n      },\n      OperationElement: {\n        leave(operationElement, key, parent, path, ancestors) {\n          const parentPathItemParameters = last(pathItemParameters);\n\n          // no Path Item Object parameters to inherit from\n          if (!Array.isArray(parentPathItemParameters) || parentPathItemParameters.length === 0) {\n            return;\n          }\n          const operationJSONPointer = ancestorLineageToJSONPointer([...ancestors, parent, operationElement]);\n\n          // skip visiting this Operation Object if it's already normalized\n          if (storage.includes(operationJSONPointer)) {\n            return;\n          }\n          const operationParameters = pathOr([], ['parameters', 'content'], operationElement);\n\n          // prefers the first item if two items compare equal based on the predicate\n          const mergedParameters = uniqWith(parameterEquals, [...operationParameters, ...parentPathItemParameters]);\n          operationElement.parameters = new OperationParametersElement(mergedParameters);\n          storage.append(operationJSONPointer);\n        }\n      }\n    }\n  };\n};\n/* eslint-enable */\n\nexport default plugin;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
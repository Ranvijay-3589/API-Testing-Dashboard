{"ast":null,"code":"import { last, defaultTo, groupBy } from 'ramda';\nimport { toValue, cloneDeep } from '@swagger-api/apidom-core';\nimport NormalizeStorage from \"./normalize-header-examples/NormalizeStorage.mjs\";\nconst removeSpaces = operationId => {\n  return operationId.replace(/\\s/g, '');\n};\nconst replaceSpecialCharsWithUnderscore = operationId => {\n  return operationId.replace(/\\W/gi, '_');\n};\nconst createNormalizedOperationId = (path, method) => {\n  const normalizedMethod = replaceSpecialCharsWithUnderscore(removeSpaces(method.toLowerCase()));\n  const normalizedPath = replaceSpecialCharsWithUnderscore(removeSpaces(path));\n  return \"\".concat(normalizedMethod).concat(normalizedPath);\n};\nconst normalizeOperationId = (operationId, path, method) => {\n  const withoutSpaces = removeSpaces(operationId);\n  if (withoutSpaces.length > 0) {\n    return replaceSpecialCharsWithUnderscore(withoutSpaces);\n  }\n  return createNormalizedOperationId(path, method);\n};\n\n/**\n * Normalization of Operation.operationId field.\n *\n * This normalization is not guided by OpenAPI 3.1 specification.\n *\n * Existing Operation.operationId fields are normalized into snake case form.\n *\n * Operation Objects, that do not define operationId field, are left untouched.\n *\n * Original operationId is stored in meta and as new `__originalOperationId` field.\n *\n * This plugin also guarantees the uniqueness of all defined Operation.operationId fields,\n * and make sure Link.operationId fields are pointing to correct and normalized Operation.operationId fields.\n *\n * NOTE: this plugin is idempotent\n * @public\n */\n\n/* eslint-disable no-param-reassign */\n/**\n * @public\n */\nconst plugin = function () {\n  let {\n    storageField = 'x-normalized',\n    operationIdNormalizer = normalizeOperationId\n  } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  return toolbox => {\n    const {\n      predicates,\n      ancestorLineageToJSONPointer,\n      namespace\n    } = toolbox;\n    const pathTemplates = [];\n    const normalizedOperations = [];\n    const links = [];\n    let storage;\n    return {\n      visitor: {\n        OpenApi3_1Element: {\n          enter(element) {\n            storage = new NormalizeStorage(element, storageField, 'operation-ids');\n          },\n          leave() {\n            // group normalized operations by normalized operationId\n            const normalizedOperationGroups = groupBy(operationElement => {\n              return toValue(operationElement.operationId);\n            }, normalizedOperations);\n\n            // append incremental numerical suffixes to identical operationIds\n            Object.entries(normalizedOperationGroups).forEach(_ref => {\n              let [normalizedOperationId, operationElements] = _ref;\n              if (!Array.isArray(operationElements)) return;\n              if (operationElements.length <= 1) return;\n              operationElements.forEach((operationElement, index) => {\n                const indexedNormalizedOperationId = \"\".concat(normalizedOperationId).concat(index + 1);\n                // @ts-ignore\n                operationElement.operationId = new namespace.elements.String(indexedNormalizedOperationId);\n              });\n            });\n\n            // rectify possibly broken Link.operationId fields\n            links.forEach(linkElement => {\n              if (typeof linkElement.operationId === 'undefined') return;\n              const linkOperationId = String(toValue(linkElement.operationId));\n              const operationElement = normalizedOperations.find(normalizedOperationElement => {\n                const originalOperationId = toValue(normalizedOperationElement.meta.get('originalOperationId'));\n                return originalOperationId === linkOperationId;\n              });\n\n              // Link Object doesn't need to be rectified\n              if (typeof operationElement === 'undefined') return;\n              linkElement.operationId = cloneDeep.safe(operationElement.operationId);\n              linkElement.meta.set('originalOperationId', linkOperationId);\n              linkElement.set('__originalOperationId', linkOperationId);\n            });\n\n            // cleanup the references\n            normalizedOperations.length = 0;\n            links.length = 0;\n            storage = undefined;\n          }\n        },\n        PathItemElement: {\n          enter(pathItemElement) {\n            // `path` meta may not be always available, e.g. in Callback Object or Components Object\n            const pathTemplate = defaultTo('path', toValue(pathItemElement.meta.get('path')));\n            pathTemplates.push(pathTemplate);\n          },\n          leave() {\n            pathTemplates.pop();\n          }\n        },\n        OperationElement: {\n          enter(operationElement, key, parent, path, ancestors) {\n            // operationId field is undefined, needs no normalization\n            if (typeof operationElement.operationId === 'undefined') return;\n            const operationJSONPointer = ancestorLineageToJSONPointer([...ancestors, parent, operationElement]);\n\n            // skip visiting this Operation Object if it's already normalized\n            if (storage.includes(operationJSONPointer)) {\n              return;\n            }\n\n            // cast operationId to string type\n            const originalOperationId = String(toValue(operationElement.operationId));\n            // perform operationId normalization\n            const pathTemplate = last(pathTemplates);\n            // `http-method` meta may not be always available, e.g. in Callback Object or Components Object\n            const method = defaultTo('method', toValue(operationElement.meta.get('http-method')));\n            const normalizedOperationId = operationIdNormalizer(originalOperationId, pathTemplate, method);\n\n            // normalization is not necessary\n            if (originalOperationId === normalizedOperationId) return;\n\n            // @ts-ignore\n            operationElement.operationId = new namespace.elements.String(normalizedOperationId);\n            operationElement.set('__originalOperationId', originalOperationId);\n            operationElement.meta.set('originalOperationId', originalOperationId);\n            normalizedOperations.push(operationElement);\n            storage.append(operationJSONPointer);\n          }\n        },\n        LinkElement: {\n          leave(linkElement) {\n            // make sure this Link elements doesn't come from base namespace\n            if (!predicates.isLinkElement(linkElement)) return;\n            // ignore Link Objects with undefined operationId\n            if (typeof linkElement.operationId === 'undefined') return;\n            links.push(linkElement);\n          }\n        }\n      }\n    };\n  };\n};\n/* eslint-enable */\n\nexport default plugin;","map":{"version":3,"names":["last","defaultTo","groupBy","toValue","cloneDeep","NormalizeStorage","removeSpaces","operationId","replace","replaceSpecialCharsWithUnderscore","createNormalizedOperationId","path","method","normalizedMethod","toLowerCase","normalizedPath","concat","normalizeOperationId","withoutSpaces","length","plugin","storageField","operationIdNormalizer","arguments","undefined","toolbox","predicates","ancestorLineageToJSONPointer","namespace","pathTemplates","normalizedOperations","links","storage","visitor","OpenApi3_1Element","enter","element","leave","normalizedOperationGroups","operationElement","Object","entries","forEach","_ref","normalizedOperationId","operationElements","Array","isArray","index","indexedNormalizedOperationId","elements","String","linkElement","linkOperationId","find","normalizedOperationElement","originalOperationId","meta","get","safe","set","PathItemElement","pathItemElement","pathTemplate","push","pop","OperationElement","key","parent","ancestors","operationJSONPointer","includes","append","LinkElement","isLinkElement"],"sources":["/var/www/ranvijay.capricorn.online/mohit/frontend/node_modules/@swagger-api/apidom-ns-openapi-3-1/src/refractor/plugins/normalize-operation-ids.mjs"],"sourcesContent":["import { last, defaultTo, groupBy } from 'ramda';\nimport { toValue, cloneDeep } from '@swagger-api/apidom-core';\nimport NormalizeStorage from \"./normalize-header-examples/NormalizeStorage.mjs\";\nconst removeSpaces = operationId => {\n  return operationId.replace(/\\s/g, '');\n};\nconst replaceSpecialCharsWithUnderscore = operationId => {\n  return operationId.replace(/\\W/gi, '_');\n};\nconst createNormalizedOperationId = (path, method) => {\n  const normalizedMethod = replaceSpecialCharsWithUnderscore(removeSpaces(method.toLowerCase()));\n  const normalizedPath = replaceSpecialCharsWithUnderscore(removeSpaces(path));\n  return `${normalizedMethod}${normalizedPath}`;\n};\nconst normalizeOperationId = (operationId, path, method) => {\n  const withoutSpaces = removeSpaces(operationId);\n  if (withoutSpaces.length > 0) {\n    return replaceSpecialCharsWithUnderscore(withoutSpaces);\n  }\n  return createNormalizedOperationId(path, method);\n};\n\n/**\n * Normalization of Operation.operationId field.\n *\n * This normalization is not guided by OpenAPI 3.1 specification.\n *\n * Existing Operation.operationId fields are normalized into snake case form.\n *\n * Operation Objects, that do not define operationId field, are left untouched.\n *\n * Original operationId is stored in meta and as new `__originalOperationId` field.\n *\n * This plugin also guarantees the uniqueness of all defined Operation.operationId fields,\n * and make sure Link.operationId fields are pointing to correct and normalized Operation.operationId fields.\n *\n * NOTE: this plugin is idempotent\n * @public\n */\n\n/* eslint-disable no-param-reassign */\n/**\n * @public\n */\nconst plugin = ({\n  storageField = 'x-normalized',\n  operationIdNormalizer = normalizeOperationId\n} = {}) => toolbox => {\n  const {\n    predicates,\n    ancestorLineageToJSONPointer,\n    namespace\n  } = toolbox;\n  const pathTemplates = [];\n  const normalizedOperations = [];\n  const links = [];\n  let storage;\n  return {\n    visitor: {\n      OpenApi3_1Element: {\n        enter(element) {\n          storage = new NormalizeStorage(element, storageField, 'operation-ids');\n        },\n        leave() {\n          // group normalized operations by normalized operationId\n          const normalizedOperationGroups = groupBy(operationElement => {\n            return toValue(operationElement.operationId);\n          }, normalizedOperations);\n\n          // append incremental numerical suffixes to identical operationIds\n          Object.entries(normalizedOperationGroups).forEach(([normalizedOperationId, operationElements]) => {\n            if (!Array.isArray(operationElements)) return;\n            if (operationElements.length <= 1) return;\n            operationElements.forEach((operationElement, index) => {\n              const indexedNormalizedOperationId = `${normalizedOperationId}${index + 1}`;\n              // @ts-ignore\n              operationElement.operationId = new namespace.elements.String(indexedNormalizedOperationId);\n            });\n          });\n\n          // rectify possibly broken Link.operationId fields\n          links.forEach(linkElement => {\n            if (typeof linkElement.operationId === 'undefined') return;\n            const linkOperationId = String(toValue(linkElement.operationId));\n            const operationElement = normalizedOperations.find(normalizedOperationElement => {\n              const originalOperationId = toValue(normalizedOperationElement.meta.get('originalOperationId'));\n              return originalOperationId === linkOperationId;\n            });\n\n            // Link Object doesn't need to be rectified\n            if (typeof operationElement === 'undefined') return;\n            linkElement.operationId = cloneDeep.safe(operationElement.operationId);\n            linkElement.meta.set('originalOperationId', linkOperationId);\n            linkElement.set('__originalOperationId', linkOperationId);\n          });\n\n          // cleanup the references\n          normalizedOperations.length = 0;\n          links.length = 0;\n          storage = undefined;\n        }\n      },\n      PathItemElement: {\n        enter(pathItemElement) {\n          // `path` meta may not be always available, e.g. in Callback Object or Components Object\n          const pathTemplate = defaultTo('path', toValue(pathItemElement.meta.get('path')));\n          pathTemplates.push(pathTemplate);\n        },\n        leave() {\n          pathTemplates.pop();\n        }\n      },\n      OperationElement: {\n        enter(operationElement, key, parent, path, ancestors) {\n          // operationId field is undefined, needs no normalization\n          if (typeof operationElement.operationId === 'undefined') return;\n          const operationJSONPointer = ancestorLineageToJSONPointer([...ancestors, parent, operationElement]);\n\n          // skip visiting this Operation Object if it's already normalized\n          if (storage.includes(operationJSONPointer)) {\n            return;\n          }\n\n          // cast operationId to string type\n          const originalOperationId = String(toValue(operationElement.operationId));\n          // perform operationId normalization\n          const pathTemplate = last(pathTemplates);\n          // `http-method` meta may not be always available, e.g. in Callback Object or Components Object\n          const method = defaultTo('method', toValue(operationElement.meta.get('http-method')));\n          const normalizedOperationId = operationIdNormalizer(originalOperationId, pathTemplate, method);\n\n          // normalization is not necessary\n          if (originalOperationId === normalizedOperationId) return;\n\n          // @ts-ignore\n          operationElement.operationId = new namespace.elements.String(normalizedOperationId);\n          operationElement.set('__originalOperationId', originalOperationId);\n          operationElement.meta.set('originalOperationId', originalOperationId);\n          normalizedOperations.push(operationElement);\n          storage.append(operationJSONPointer);\n        }\n      },\n      LinkElement: {\n        leave(linkElement) {\n          // make sure this Link elements doesn't come from base namespace\n          if (!predicates.isLinkElement(linkElement)) return;\n          // ignore Link Objects with undefined operationId\n          if (typeof linkElement.operationId === 'undefined') return;\n          links.push(linkElement);\n        }\n      }\n    }\n  };\n};\n/* eslint-enable */\n\nexport default plugin;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}